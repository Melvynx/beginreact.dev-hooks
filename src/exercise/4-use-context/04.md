# useContext

C'est quoi `useContext` ? Il permet de partager de la logique (valeur, function)
entre plusieurs composants sans avoir Ã  passer des props.

Ce hooks rÃ©pond Ã  cette question :

> Comment passer une props Ã  un enfant qui est trÃ¨s loins dans le DOM ?

[ğŸ“– useContext - RÃ©cupÃ©rer des donnÃ©es du contexte](https://beta.reactjs.org/apis/usecontext#passing-data-deeply-into-the-tree)

On va jeter un coup d'Å“il Ã  la doc ensemble, mais le meilleur moyen de comprendre reste la pratique.

# Exercice

On va faire un dark mode.

Dans le fichier exercice, j'ai dÃ©jÃ  fait toute la logique du dark mode.

Ta mission est de modifier notre application pour utiliser un Context afin
de ne pas passer des props de notre app Ã  tous les composants.

Pour Ã§a, comme d'habitude, tu as les Ã©mojis du Lienx pour t'aider.

- ğŸ’Œ Tu comprends comment utiliser les useContext

## Extra 2

Tu vois que l'on utilise tous le temps `useContext(ThemeContextContext);` et c'est pas
trÃ¨s propre.

Le mieux est de crÃ©er un custom hooks `useThemeContext` qui va retourner notre context
mais qui en plus **va vÃ©rifier que notre context n'est pas vide**. S'il est vide, c'est que nous sommes en dehors de notre provider !

Dans ce cas, on va throw une erreur !

On ne peut qu'utiliser un context quand dans l'arbre, au-dessus de notre composant,
il y a un context provider.

Si par mÃ©garde qqn utilise ce context hors du context provider, on veut qu'il
reÃ§ois une erreur.

Pour tester, tu peux tout simplement utiliser la fonction `useThemeContext` dans
le composant `App` et vÃ©rifier que tu aies une erreur.

- ğŸ’Œ Tu comprends comment utiliser les custom hooks pour vÃ©rifier que le context
  est bien utilisÃ© et simplifiÃ© le code.

## Extra 3

Si tu ajoutes un `console.log` dans les boutons "Force light"
et "Force Dark", tu verras qu'ils sont rerender...

Mais ils n'utilisent pas le theme, il le modifie. Ils n'ont mÃªme pas besoin
de savoir si c'est "light" ou "dark".

Pour Ã©viter de rerender les composants qui n'ont pas besoin de **lire** le thÃ¨me,
crÃ©e un deuxiÃ¨me context : "ThemeContextDispatch" qui va contenir les fonctions
`setLight`, `setDark` et `Toggle`.

ğŸ’¡ Tips de code :

```jsx
const values = { theme, isDark, isLight };
const dispatchValues = { setLight, setDark, toggle };

return (
  <ThemeContext.Provider value={values}>
    <ThemeContextDispatch.Provider value={dispatchValues}>
      {children}
    </ThemeContextDispatch.Provider>
  </ThemeContext.Provider>
);
```

Il faudra aussi crÃ©er `useThemeDispatchContext` pour utiliser ce context.

ğŸ’¡ Aie Ã§a ne va pas fonctionner.

Effectivement ici la value qu'on passe **est regÃ©nÃ©r Ã  chaque render** !

Quand on fait { setLight, setDark, toggle } on crÃ©e un nouvel objet Ã  chaque render.

Ce qui provoque le render de tous les composants qui utilisent notre context.

Pour rÃ©soudre ce problÃ¨me il faut utiliser `useMemo` !

ğŸ’¡ Tips de code

```jsx
const dispatchValues = useMemo(() => ({ setLight, setDark, toggle }), []);
```

useMemo **va garder le mÃªme objet entre les renders** sauf si le tableau
de dÃ©pendance change.

[ğŸ“– Un super article sur le useMemo](https://kentcdodds.com/blog/usememo-and-usecallback)
[ğŸ“– Le meilleur article sur useMemo](https://www.joshwcomeau.com/react/usememo-and-usecallback/)

- ğŸ’Œ Tu apprends Ã  optimiser un context
- ğŸ’Œ Tu apprends Ã  utiliser le useMemo

#

#

#

#

#

#

## Extra 4 (bonus)

âš ï¸ Il va falloir que tu annules tous les changements faits dans l'extra 3.

On va utiliser la librairie `use-context-selector` pour rendre notre code 20x plus simple
et plus optimiser.

[ğŸ“– use-context-selector](https://github.com/dai-shi/use-context-selector)

La libraire est super facile.

Il faut que tu remplaces le `createContext` de React par celui de `use-context-selector`.

Tu vas devoir modifier lÃ©gÃ¨rement le hooks `useThemeContext` pour qu'ils prennent
une fonction en paramÃ¨tre puis modifiÃ© le `useContext` en `useContextSelector` en
passant comme second argument la fonction.

En suite pour chaque usage, tu vas **sÃ©lectionner** la valeur que tu veux.

Je te laisse galÃ©rer un peu, mais si tu bloques n'hÃ©site pas Ã  me demander de l'aide.

- ğŸ’Œ Tu apprends Ã  utiliser une librairie pour simplifier le code
